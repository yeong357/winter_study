<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="/main.css" rel="stylesheet">
</head>
<body class="grey-bg">
    <%# JSON.stringify(list) %>
    <%- include('nav.ejs') %>
    <%# í•´ë‹¹ ejs íŒŒì¼ì— ìˆë˜ htmlì„ ëª¨ë‘ ë³µì‚¬í•´ì˜´ %>

    <input class="search">
    <button class="search-send">ê²€ìƒ‰</button>

    <script>
        document.querySelector('.search-send').addEventListener('click', function(){
            let searchData = document.querySelector('.search').value
            location.href = '/search?val=' + searchData //ì—¬ê¸°ë¡œ í˜ì´ì§€ ì´ë™ì‹œì¼œ ì£¼ì„¸ìš”
        })
    </script>

    <div class="white-bg">
        <% for (let i = 0; i<list.length; i++) { %>
            <div class="list-box">
                <h4>
                    <a href="/detail/<%= list[i]._id %>">
                    <%= list[i].title %>
                    </a>
                    <a href="/edit/<%= list[i]._id %>">âœï¸</a>
                    <%# ìˆ˜ì • ë²„íŠ¼ ì¶”ê°€ %>
                    <%# ìˆ˜ì • ê¸°ëŠ¥: 1. ìˆ˜ì •ë²„íŠ¼ ëˆ„ë¥´ë©´ ìˆ˜ì • í˜ì´ì§€ë¡œ ì´ë™ %>
                    <%# 2. ìˆ˜ì • í˜ì´ì§€ì—” ê¸°ì¡´ ê¸€ì´ ì±„ì›Œì ¸ ìˆìŒ %>
                    <%# 3. ì „ì†¡ ëˆ„ë¥´ë©´ ì…ë ¥í•œ ë‚´ìš©ìœ¼ë¡œ DB ê¸€ ìˆ˜ì • %>
                    <span class="delete" data-id="<%= list[i]._id %>">ğŸ—‘ï¸</span>
                </h4>
                <p><%= list[i].content %></p>
            </div>
        <% } %> 
    </div> 


    <a href="/list/next/<%= list[list.length-1]._id %>">ë‹¤ìŒ</a>


    <script>
        for (let i = 0; i< '<%= list.length %>'; i++){
            document.querySelectorAll('.delete')[i].addEventListener('click', function (e){
                e.target.dataset.id
                fetch('/delete?docid=' + e.target.dataset.id, {
                    method : 'DELETE',
                })//ajax ê¸°ëŠ¥ìœ¼ë¡œ ìƒˆë¡œê³ ì¹¨ ì—†ì´ post ìš”ì²­ 
            .then((r)=>r.text())
            .then((r)=>{
                e.target.parentElement.parentElement.style.display = 'none'
                //targetì˜ ë¶€ëª¨ì˜ ë¶€ëª¨ë¥¼ ì°¾ì•„ì„œ cssë¡œ ì•ˆ ë³´ì´ê²Œ ì²˜ë¦¬í•¨
            })
            })
        }
    </script>

    <script>
        let eventSource = new EventSource('/stream/list')
        eventSource.addEventListener('msg', function(e){
            console.log(e.data)//ì„œë²„ë¡œ ë³´ë‚¸ ë°ì´í„°ëŠ” eì•ˆì— ë“¤ì–´ìˆìŒ
            
            let ê°€ì ¸ì˜¨ê±° = JSON.parse(e.data) //ë‹¤ì‹œ array, objectë¡œ ë°”ê¿”ì¤Œ -> .title ì‚¬ìš© ê°€ëŠ¥í•´ì§
            document.querySelector('.white-bg').insertAdjacentHTML('afterbegin', `<div class="list-box"><h4>${ê°€ì ¸ì˜¨ê±°.title}</h4></div>`)
        })
    </script>
  
  </body>
</html>